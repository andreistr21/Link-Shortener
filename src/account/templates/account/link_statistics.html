{% extends 'common/base.html' %}
{% load static %}
{% load account_custom_tags %}
{% block title %}
    Link Statistics
{% endblock title %}
{% block content %}
    <section class="section-account">
        <div class="section-center">
            <div class="statistics">
                <div class="clicks-statistics">
                    <canvas id="clicksChart"></canvas>
                </div>
                <div class="countries-statistics">
                    <canvas id="countriesChart"></canvas>
                </div>
            </div>
        </div>
    </section>
{% endblock content %}
{% block script %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.2.1/dist/chart.umd.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js" integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous">
    </script>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap-v4-grid-only@1.0.0/dist/bootstrap-grid.min.css">
    <script>
        let salesCtx = document.getElementById("clicksChart").getContext("2d");
        let salesChart = new Chart(salesCtx, {
            type: "bar",
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: ""
                },
                maintainAspectRatio: false
            }
        });

        let countriesCtx = document.getElementById("countriesChart").getContext("2d");
        let countriesChart = new Chart(countriesCtx, {
            type: "pie",
            options: {
                responsive: true,
                title: {
                    display: true,
                    text: ""
                },
            }
        });
    </script>
    <script>
        $(document).ready(function() {
            var chartData = JSON.parse("{{ clicks_chart_dataset|safe|escapejs }}")
            console.log(chartData)
            const datasets = chartData.data.datasets;

            // Reset the current chart
            salesChart.data.datasets = [];
            salesChart.data.labels = [];

            // Load new data into the chart
            salesChart.options.title.text = chartData.title;
            salesChart.options.title.display = true;
            salesChart.data.labels = chartData.data.labels;
            datasets.forEach(dataset => {
                salesChart.data.datasets.push(dataset);
            });
            salesChart.update();
        });

        $(document).ready(function() {
            var pieChartData = JSON.parse("{{ country_chart_dataset|safe|escapejs }}")
            console.log(pieChartData)
            const datasets = pieChartData.data.datasets;

            // Reset the current chart
            countriesChart.data.datasets = [];
            countriesChart.data.labels = [];

            // Load new data into the chart
            countriesChart.options.title.text = pieChartData.title;
            countriesChart.options.title.display = true;
            countriesChart.data.labels = pieChartData.data.labels;
            datasets.forEach(dataset => {
                countriesChart.data.datasets.push(dataset);
            });
            countriesChart.update();
        });
    </script>
{% endblock script %}
